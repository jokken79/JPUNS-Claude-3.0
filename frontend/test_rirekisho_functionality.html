<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>履歴書 - Prueba de Funcionalidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Librería para la conversión precisa de Romaji a Kana (Katakana/Hiragana) -->
    <script src="https://cdn.jsdelivr.net/npm/wanakana@5.3.0/umd/wanakana.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fbfcfd;
            color: #1f2937;
            padding: 20px;
        }
        .test-section {
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        .test-result.success { background: #D1FAE5; color: #059669; }
        .test-result.error { background: #FEE2E2; color: #DC2626; }
        input, select, textarea {
            border: 1px solid #d1d5db;
            padding: 8px 12px;
            border-radius: 6px;
            transition: border-color 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #1D4ED8;
            outline: none;
            box-shadow: 0 0 0 1px #1D4ED8;
        }
        .btn-primary {
            background-color: #1D4ED8; color: white; padding: 10px 18px;
            border-radius: 8px; font-weight: 600; transition: background-color 0.2s;
            border: none; cursor: pointer;
        }
        .btn-primary:hover { background-color: #1E40AF; }
    </style>
</head>
<body>
    <div class="container mx-auto max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-blue-800">履歴書 - Prueba de Funcionalidades</h1>
            <p class="text-lg text-gray-600">Página de prueba para verificar las mejoras implementadas</p>
        </header>

        <main class="space-y-8">
            <!-- Prueba de Conversión de Romaji a Katakana -->
            <section class="test-section">
                <h2 class="text-2xl font-bold mb-4">1. Conversión de Romaji a Katakana</h2>
                <p class="text-sm text-gray-600 mb-4">Escribe un nombre en romaji (ej. MAI TU ANH) y verifica la conversión automática a katakana.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">氏名 (Romaji)</label>
                        <input type="text" id="test_name_kanji" placeholder="MAI TU ANH">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">フリガナ (Katakana)</label>
                        <input type="text" id="test_name_furigana" readonly class="bg-gray-100">
                    </div>
                </div>
                
                <div id="romaji_test_result" class="test-result hidden"></div>
                <button onclick="testRomajiConversion()" class="btn-primary mt-4">Probar Conversión</button>
            </section>

            <!-- Prueba de Cálculo de Edad -->
            <section class="test-section">
                <h2 class="text-2xl font-bold mb-4">2. Cálculo Automático de Edad</h2>
                <p class="text-sm text-gray-600 mb-4">Selecciona una fecha de nacimiento y verifica que la edad se calcule automáticamente.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">生年月日</label>
                        <input type="date" id="test_birthday">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">年齢</label>
                        <input type="number" id="test_age" readonly class="bg-gray-100">
                    </div>
                </div>
                
                <div id="age_test_result" class="test-result hidden"></div>
                <button onclick="testAgeCalculation()" class="btn-primary mt-4">Probar Cálculo de Edad</button>
            </section>

            <!-- Prueba de Formato de Fechas Japonés -->
            <section class="test-section">
                <h2 class="text-2xl font-bold mb-4">3. Formato de Fechas Japonés</h2>
                <p class="text-sm text-gray-600 mb-4">Selecciona una fecha y verifica el formato japonés (año-mes-día).</p>
                
                <div>
                    <label class="block text-sm font-medium mb-1">Fecha</label>
                    <input type="date" id="test_date">
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium mb-1">Formato Japonés</label>
                    <input type="text" id="test_date_japanese" readonly class="bg-gray-100">
                </div>
                
                <div id="date_test_result" class="test-result hidden"></div>
                <button onclick="testDateFormatting()" class="btn-primary mt-4">Probar Formato de Fechas</button>
            </section>

            <!-- Prueba de Funciones OCR -->
            <section class="test-section">
                <h2 class="text-2xl font-bold mb-4">4. Funciones OCR Simuladas</h2>
                <p class="text-sm text-gray-600 mb-4">Simula la entrada de datos desde OCR y verifica el procesamiento.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Nombre (OCR)</label>
                        <input type="text" id="test_ocr_name" placeholder="MAI TU ANH">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Fecha de Nacimiento (OCR)</label>
                        <input type="date" id="test_ocr_birthday">
                    </div>
                </div>
                
                <div id="ocr_test_result" class="test-result hidden"></div>
                <button onclick="testOCRProcessing()" class="btn-primary mt-4">Probar Procesamiento OCR</button>
            </section>
        </main>
    </div>

    <script>
        // Importar las funciones del formulario principal
        // FUNCIÓN: Formatear fecha a formato japonés (año-mes-día)
        function formatDateJapanese(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }


        // FUNCIÓN: Calcular edad automáticamente desde fecha de nacimiento
        function calculateAge(birthDate) {
            if (!birthDate) return '';
            
            const today = new Date();
            const birth = new Date(birthDate);
            
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        // FUNCIÓN: Conversión de Romaji a Katakana
        function convertRomajiToFurigana(romajiText) {
            if (typeof wanakana === 'undefined') {
                console.error('WanaKana library not loaded.');
                return '';
            }
            
            // 1. Convierte a mayúsculas para manejar el formato estándar Romaji (ej. YAMADA TARO)
            const uppercaseInput = romajiText.toUpperCase();
            
            // 2. Convierte el Romaji (entrada en mayúsculas) a Katakana
            let katakana = wanakana.toKatakana(uppercaseInput);
            
            // 3. Reemplazar caracteres especiales que no se convierten correctamente
            katakana = katakana
                .replace(/TU/g, 'トゥ')  // Para "tu" -> "トゥ"
                .replace(/DI/g, 'ディ')  // Para "di" -> "ディ"
                .replace(/DU/g, 'ドゥ')  // Para "du" -> "ドゥ"
                .replace(/FA/g, 'ファ')  // Para "fa" -> "ファ"
                .replace(/FI/g, 'フィ')  // Para "fi" -> "フィ"
                .replace(/FE/g, 'フェ')  // Para "fe" -> "フェ"
                .replace(/FO/g, 'フォ')  // Para "fo" -> "フォ"
                .replace(/JE/g, 'ジェ')  // Para "je" -> "ジェ"
                .replace(/WE/g, 'ウェ')  // Para "we" -> "ウェ"
                .replace(/WI/g, 'ウィ'); // Para "wi" -> "ウィ"
                
            return katakana;
        }

        // FUNCIÓN: Actualizar automáticamente フリガナ desde 氏名
        function autoUpdateFurigana(nameValue) {
            let convertMessage = '';
            let furiganaValue = '';
            
            // Si el nombre está en Romaji (solo letras latinas), convertir a Katakana
            if (/^[A-Za-z\s]+$/.test(nameValue)) {
                furiganaValue = convertRomajiToFurigana(nameValue);
                convertMessage = 'ローマ字からフリガナに変換しました';
                
                // Ejemplo: MAI TU ANH -> マイ　トゥ　アン
                console.log(`Conversión: "${nameValue}" -> "${furiganaValue}"`);
            }
            // Si el nombre contiene Kana, copiar directamente a フリガナ
            else if (/[\u3040-\u309F\u30A0-\u30FF]/.test(nameValue)) {
                furiganaValue = nameValue;
                convertMessage = 'カナをフリガナに設定しました';
            }
            // Si el nombre contiene Kanji, intentar leerlo con la librería
            else if (/[\u4E00-\u9FAF]/.test(nameValue)) {
                // Para Kanji, mostramos un mensaje indicando que debe ser revisado manualmente
                furiganaValue = nameValue; // Mantener el kanji como referencia
                convertMessage = '漢字のフリガナを手動で確認してください';
            }
            else {
                // Limpiar フリガナ si no hay texto válido
                furiganaValue = '';
                convertMessage = '';
            }
            
            return { furiganaValue, convertMessage };
        }

        // Inicializar event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Event listener para conversión de romaji a katakana
            document.getElementById('test_name_kanji').addEventListener('input', (event) => {
                const nameValue = event.target.value;
                const result = autoUpdateFurigana(nameValue);
                document.getElementById('test_name_furigana').value = result.furiganaValue;
            });

            // Event listener para cálculo de edad
            document.getElementById('test_birthday').addEventListener('change', (event) => {
                const birthDate = event.target.value;
                const age = calculateAge(birthDate);
                document.getElementById('test_age').value = age;
            });

            // Event listener para formato de fechas
            document.getElementById('test_date').addEventListener('change', (event) => {
                const dateValue = event.target.value;
                document.getElementById('test_date_japanese').value = formatDateJapanese(dateValue);
            });
        });

        // Funciones de prueba
        function testRomajiConversion() {
            const nameInput = document.getElementById('test_name_kanji').value;
            const furiganaOutput = document.getElementById('test_name_furigana').value;
            const resultDiv = document.getElementById('romaji_test_result');
            
            if (!nameInput) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'Error: Por favor, ingrese un nombre en romaji.';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            const expectedOutput = convertRomajiToFurigana(nameInput);
            const isCorrect = furiganaOutput === expectedOutput;
            
            resultDiv.className = isCorrect ? 'test-result success' : 'test-result error';
            resultDiv.textContent = isCorrect 
                ? `✓ Correcto: "${nameInput}" -> "${furiganaOutput}"`
                : `✗ Error: Se esperaba "${expectedOutput}" pero se obtuvo "${furiganaOutput}"`;
            resultDiv.classList.remove('hidden');
        }

        function testAgeCalculation() {
            const birthdayInput = document.getElementById('test_birthday').value;
            const ageOutput = document.getElementById('test_age').value;
            const resultDiv = document.getElementById('age_test_result');
            
            if (!birthdayInput) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'Error: Por favor, seleccione una fecha de nacimiento.';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            const expectedAge = calculateAge(birthdayInput);
            const isCorrect = parseInt(ageOutput) === parseInt(expectedAge);
            
            resultDiv.className = isCorrect ? 'test-result success' : 'test-result error';
            resultDiv.textContent = isCorrect 
                ? `✓ Correcto: Edad calculada ${ageOutput} años desde ${formatDateJapanese(birthdayInput)}`
                : `✗ Error: Se esperaba ${expectedAge} años pero se obtuvo ${ageOutput}`;
            resultDiv.classList.remove('hidden');
        }

        function testDateFormatting() {
            const dateInput = document.getElementById('test_date').value;
            const japaneseOutput = document.getElementById('test_date_japanese').value;
            const resultDiv = document.getElementById('date_test_result');
            
            if (!dateInput) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'Error: Por favor, seleccione una fecha.';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            const expectedJapanese = formatDateJapanese(dateInput);
            const isJapaneseCorrect = japaneseOutput === expectedJapanese;
            
            if (isJapaneseCorrect) {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `✓ Correcto: Formato japonés "${japaneseOutput}"`;
            } else {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `✗ Error: Se esperaba "${expectedJapanese}"`;
            }
            resultDiv.classList.remove('hidden');
        }

        function testOCRProcessing() {
            const nameInput = document.getElementById('test_ocr_name').value;
            const birthdayInput = document.getElementById('test_ocr_birthday').value;
            const resultDiv = document.getElementById('ocr_test_result');
            
            if (!nameInput || !birthdayInput) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'Error: Por favor, complete todos los campos.';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            // Simular procesamiento OCR
            const furiganaResult = autoUpdateFurigana(nameInput);
            const ageResult = calculateAge(birthdayInput);
            const japaneseDate = formatDateJapanese(birthdayInput);
            
            resultDiv.className = 'test-result success';
            resultDiv.innerHTML = `
                ✓ Procesamiento OCR simulado exitoso:<br>
                - Nombre: "${nameInput}" -> フリガナ: "${furiganaResult.furiganaValue}"<br>
                - Fecha de nacimiento: ${japaneseDate}<br>
                - Edad calculada: ${ageResult} años<br>
                - Mensaje: ${furiganaResult.convertMessage}
            `;
            resultDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>